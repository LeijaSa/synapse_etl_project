{
	"name": "createfactlibrarytable",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "silverlibrarydataflowparquet",
						"type": "DatasetReference"
					},
					"name": "libraryparquet"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "select1"
				},
				{
					"name": "unpivot1"
				}
			],
			"scriptLines": [
				"source(output(",
				"          kunta as string,",
				"          vuosi as integer,",
				"          kokoelmat as integer,",
				"          kokoelmat_kirjat_yhteensa as integer,",
				"          kokoelmat_suomenkieliset_kirjat as integer,",
				"          kokoelmat_ruotsinkieliset_kirjat as integer,",
				"          kokoelmat_muunkieliset_kirjat as integer,",
				"          kokoelmat_kaunokirjat_aikuiset as integer,",
				"          kokoelmat_kaunokirjat_lapset as integer,",
				"          kokoelmat_tietokirjat_aikuiset as integer,",
				"          kokoelmat_tietokirjat_lapset as integer,",
				"          kokoelmat_nuotit_ja_partituurit as integer,",
				"          kokoelmat_musiikkiaanitteet as integer,",
				"          kokoelmat_muut_aanitteet as integer,",
				"          kokoelmat_videotallenteet as integer,",
				"          kokoelmat_muut_aineistot as integer,",
				"          kokoelmat_videot as integer,",
				"          kokoelmat_cd_rom_levyt as integer,",
				"          kokoelmat_dvd_ja_blue_ray_levyt as integer,",
				"          kokonaislainaus as integer,",
				"          lainaus_yhteensa as integer,",
				"          lainaus_kirjat_yhteensa as integer,",
				"          lainaus_suomenkieliset_kirjat as integer,",
				"          lainaus_ruotsinkieliset_kirjat as integer,",
				"          lainaus_muunkieliset_kirjat as integer,",
				"          lainaus_kaunokirjat_aikuiset as integer,",
				"          lainaus_kaunokirjat_lapset as integer,",
				"          lainaus_tietokirjat_aikuiset as integer,",
				"          lainaus_tietokirjat_lapset as integer,",
				"          lainaus_nuotit_ja_partituurit as integer,",
				"          lainaus_musiikkiaanitteet as integer,",
				"          lainaus_muut_aanitteet as integer,",
				"          lainaus_celian_aanikirjat_cd_levyina as integer,",
				"          lainaus_videotallenteet as integer,",
				"          lainaus_muut_aineistot as integer,",
				"          lainaus_videot as integer,",
				"          lainat_cd_rom_levyt as integer,",
				"          lainaus_dvd_ja_blu_ray_levyt as integer,",
				"          toimintakulut_tilastovuonna as decimal(12,2),",
				"          henkilostokulut as decimal(12,2),",
				"          kirjastoaineistokulut as decimal(12,2),",
				"          kirjojen_hankintakulut as decimal(12,2),",
				"          e_aineistokulut as decimal(12,2),",
				"          tilakustannukset as decimal(12,2),",
				"          muut_kulut as decimal(12,2),",
				"          toimintakulut_kuluvan_vuoden_talousarviossa as decimal(12,2)",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     format: 'parquet') ~> libraryparquet",
				"libraryparquet select(mapColumn(",
				"          kunta,",
				"          vuosi,",
				"          kokoelmat_suomenkieliset_kirjat,",
				"          kokoelmat_ruotsinkieliset_kirjat,",
				"          kokoelmat_muunkieliset_kirjat,",
				"          kokoelmat_kaunokirjat_aikuiset,",
				"          kokoelmat_kaunokirjat_lapset,",
				"          kokoelmat_tietokirjat_aikuiset,",
				"          kokoelmat_tietokirjat_lapset,",
				"          kokoelmat_nuotit_ja_partituurit,",
				"          kokoelmat_musiikkiaanitteet,",
				"          kokoelmat_muut_aanitteet,",
				"          kokoelmat_videotallenteet,",
				"          kokoelmat_muut_aineistot,",
				"          kokoelmat_videot,",
				"          kokoelmat_cd_rom_levyt,",
				"          kokoelmat_dvd_ja_blue_ray_levyt,",
				"          lainaus_suomenkieliset_kirjat,",
				"          lainaus_ruotsinkieliset_kirjat,",
				"          lainaus_muunkieliset_kirjat,",
				"          lainaus_kaunokirjat_aikuiset,",
				"          lainaus_kaunokirjat_lapset,",
				"          lainaus_tietokirjat_aikuiset,",
				"          lainaus_tietokirjat_lapset,",
				"          lainaus_nuotit_ja_partituurit,",
				"          lainaus_musiikkiaanitteet,",
				"          lainaus_muut_aanitteet,",
				"          lainaus_celian_aanikirjat_cd_levyina,",
				"          lainaus_videotallenteet,",
				"          lainaus_muut_aineistot,",
				"          lainaus_videot,",
				"          lainat_cd_rom_levyt,",
				"          lainaus_dvd_ja_blu_ray_levyt",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select1",
				"select1 unpivot(output(",
				"          kategoria as string,",
				"          kategoria_kokoelma as string,",
				"          kokoelma_maara as integer",
				"     ),",
				"     ungroupBy(kokoelmat_suomenkieliset_kirjat,",
				"          kokoelmat_ruotsinkieliset_kirjat,",
				"          kokoelmat_muunkieliset_kirjat,",
				"          kokoelmat_kaunokirjat_aikuiset,",
				"          kokoelmat_kaunokirjat_lapset,",
				"          kokoelmat_tietokirjat_aikuiset,",
				"          kokoelmat_tietokirjat_lapset,",
				"          kokoelmat_nuotit_ja_partituurit,",
				"          kokoelmat_musiikkiaanitteet,",
				"          kokoelmat_muut_aanitteet,",
				"          kokoelmat_videotallenteet,",
				"          kokoelmat_muut_aineistot,",
				"          kokoelmat_videot,",
				"          kokoelmat_cd_rom_levyt,",
				"          kokoelmat_dvd_ja_blue_ray_levyt),",
				"     lateral: true,",
				"     ignoreNullPivots: false) ~> unpivot1"
			]
		}
	}
}